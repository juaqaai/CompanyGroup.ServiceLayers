// -- Sammy.js -- /plugins/sammy.storage.js
// http://sammyjs.org
// Version: 0.7.2
// Built: 2012-10-19 23:50:29 -0400
(function(e){Sammy=Sammy||{},Sammy.Store=function(t){var n=this;this.options=t||{},this.name=this.options.name||"store",this.element=this.options.element||"body",this.$element=e(this.element),e.isArray(this.options.type)?e.each(this.options.type,function(e,t){if(Sammy.Store.isAvailable(t))return n.type=t,!1}):this.type=this.options.type||"memory",this.meta_key=this.options.meta_key||"__keys__",this.storage=new Sammy.Store[Sammy.Store.stores[this.type]](this.name,this.element,this.options)},Sammy.Store.stores={memory:"Memory",data:"Data",local:"LocalStorage",session:"SessionStorage",cookie:"Cookie"},e.extend(Sammy.Store.prototype,{isAvailable:function(){return e.isFunction(this.storage.isAvailable)?this.storage.isAvailable():!0},exists:function(e){return this.storage.exists(e)},set:function(e,t){var n=typeof t=="string"?t:JSON.stringify(t);return e=e.toString(),this.storage.set(e,n),e!=this.meta_key&&(this._addKey(e),this.$element.trigger("set-"+this.name,{key:e,value:t}),this.$element.trigger("set-"+this.name+"-"+e,{key:e,value:t})),t},get:function(e){var t=this.storage.get(e);if(typeof t=="undefined"||t==null||t=="")return t;try{return JSON.parse(t)}catch(n){return t}},clear:function(e){return this._removeKey(e),this.storage.clear(e)},clearAll:function(){var e=this;this.each(function(t,n){e.clear(t)})},keys:function(){return this.get(this.meta_key)||[]},each:function(e){var t=0,n=this.keys(),r;for(t;t<n.length;t++){r=e(n[t],this.get(n[t]));if(r===!1)return!1}},filter:function(e){var t=[];return this.each(function(n,r){return e(n,r)&&t.push([n,r]),!0}),t},first:function(e){var t=!1;return this.each(function(n,r){if(e(n,r))return t=[n,r],!1}),t},fetch:function(e,t){return this.exists(e)?this.get(e):this.set(e,t.apply(this))},load:function(t,n,r){var i=this;e.get(n,function(e){i.set(t,e),r&&r.apply(this,[e])})},_addKey:function(t){var n=this.keys();e.inArray(t,n)==-1&&n.push(t),this.set(this.meta_key,n)},_removeKey:function(t){var n=this.keys(),r=e.inArray(t,n);r!=-1&&n.splice(r,1),this.set(this.meta_key,n)}}),Sammy.Store.isAvailable=function(e){try{return Sammy.Store[Sammy.Store.stores[e]].prototype.isAvailable()}catch(t){return!1}},Sammy.Store.Memory=function(e,t){this.name=e,this.element=t,this.namespace=[this.element,this.name].join("."),Sammy.Store.Memory.store=Sammy.Store.Memory.store||{},Sammy.Store.Memory.store[this.namespace]=Sammy.Store.Memory.store[this.namespace]||{},this.store=Sammy.Store.Memory.store[this.namespace]},e.extend(Sammy.Store.Memory.prototype,{isAvailable:function(){return!0},exists:function(e){return typeof this.store[e]!="undefined"},set:function(e,t){return this.store[e]=t},get:function(e){return this.store[e]},clear:function(e){delete this.store[e]}}),Sammy.Store.Data=function(t,n){this.name=t,this.element=n,this.$element=e(n)},e.extend(Sammy.Store.Data.prototype,{isAvailable:function(){return!0},exists:function(e){return!!this.$element.data(this._key(e))},set:function(e,t){return this.$element.data(this._key(e),t)},get:function(e){return this.$element.data(this._key(e))},clear:function(e){this.$element.removeData(this._key(e))},_key:function(e){return["store",this.name,e].join(".")}}),Sammy.Store.LocalStorage=function(e,t){this.name=e,this.element=t},e.extend(Sammy.Store.LocalStorage.prototype,{isAvailable:function(){return"localStorage"in window&&window.location.protocol!="file:"},exists:function(e){return this.get(e)!=null},set:function(e,t){return window.localStorage.setItem(this._key(e),t)},get:function(e){return window.localStorage.getItem(this._key(e))},clear:function(e){window.localStorage.removeItem(this._key(e))},_key:function(e){return["store",this.element,this.name,e].join(".")}}),Sammy.Store.SessionStorage=function(e,t){this.name=e,this.element=t},e.extend(Sammy.Store.SessionStorage.prototype,{isAvailable:function(){return"sessionStorage"in window&&window.location.protocol!="file:"&&e.isFunction(window.sessionStorage.setItem)},exists:function(e){return this.get(e)!=null},set:function(e,t){return window.sessionStorage.setItem(this._key(e),t)},get:function(e){var t=window.sessionStorage.getItem(this._key(e));return t&&typeof t.value!="undefined"&&(t=t.value),t},clear:function(e){window.sessionStorage.removeItem(this._key(e))},_key:function(e){return["store",this.element,this.name,e].join(".")}}),Sammy.Store.Cookie=function(e,t,n){this.name=e,this.element=t,this.options=n||{},this.path=this.options.path||"/",this.expires_in=this.options.expires_in||1209600},e.extend(Sammy.Store.Cookie.prototype,{isAvailable:function(){return"cookie"in document&&window.location.protocol!="file:"},exists:function(e){return this.get(e)!=null},set:function(e,t){return this._setCookie(e,t)},get:function(e){return this._getCookie(e)},clear:function(e){this._setCookie(e,"",-1)},_key:function(e){return["store",this.element,this.name,e].join(".")},_getCookie:function(e){var t=this._key(e).replace(/(\.|\*|\(|\)|\[|\])/g,"\\$1"),n=document.cookie.match("(^|;\\s)"+t+"=([^;]*)(;|$)");return n?n[2]:null},_setCookie:function(e,t,n){n||(n=this.expires_in*1e3);var r=new Date;r.setTime(r.getTime()+n);var i=[this._key(e),"=",t,"; expires=",r.toGMTString(),"; path=",this.path].join("");document.cookie=i}}),Sammy.Storage=function(t){this.use(Sammy.JSON),this.stores=this.stores||{},this.store=function(t,n){if(typeof this.stores[t]=="undefined"){var r="clear"+t.substr(0,1).toUpperCase()+t.substr(1);this.stores[t]=new Sammy.Store(e.extend({name:t,element:this.element_selector},n||{})),this[t]=function(n,r){return typeof r=="undefined"?this.stores[t].get(n):e.isFunction(r)?this.stores[t].fetch(n,r):this.stores[t].set(n,r)},this[r]=function(){return this.stores[t].clearAll()},this.helper(t,function(){return this.app[t].apply(this.app,arguments)}),this.helper(r,function(){return this.app[r]()})}return this.stores[t]},this.helpers({store:function(){return this.app.store.apply(this.app,arguments)}})},Sammy.Session=function(t,n){this.use(Sammy.Storage),this.store("session",e.extend({type:["local","cookie","memory"]},n))},Sammy.Cache=function(t,n){this.use(Sammy.Storage),this.cache_partials=!0,this.store("cache",e.extend({type:["local","session","memory"]},n))}})(jQuery);
